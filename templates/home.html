<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockSight - Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <main class="home-main">
        <!-- Logo Section -->
        <div class="home-logo-section">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="StockSight Logo" class="home-logo">
        </div>

        <!-- Search Section -->
        <section class="search-section">
            <div class="search-container">
                <h2>Find Your Stock</h2>
                <p class="search-description">Search for any stock symbol from Yahoo Finance</p>
                
                <form class="search-form" action="/search" method="GET" onsubmit="handleSearch(event)">
                    <div class="search-input-group">
                        <input type="text" 
                               id="stockSearch" 
                               name="ticker" 
                               placeholder="Enter any stock symbol (e.g., AAPL, TSLA, MSFT...)" 
                               class="search-input"
                               autocomplete="off">
                    </div>
                    <!-- Suggestions container -->
                    <div id="searchSuggestions" class="search-suggestions"></div>
                    <div id="searchMessage" class="search-message"></div>
                </form>
            </div>
        </section>

        <!-- Quick Access Section -->
        <section class="quick-access-section">
            <h3>Quick Access</h3>
            <div class="quick-access-grid">
                {% for stock in quick_stocks %}
                <div class="quick-access-card" onclick="navigateToStock('{{ stock.symbol }}')">
                    <div class="stock-header">
                        <h4 class="stock-symbol">{{ stock.symbol }}</h4>
                        <span class="stock-price">{{ stock.price }}</span>
                    </div>
                    <p class="stock-name">{{ stock.name }}</p>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message {{ category }}">
                            <i class="fas fa-{% if category == 'success' %}check-circle{% elif category == 'danger' %}exclamation-circle{% else %}info-circle{% endif %}"></i>
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
    </main>

    <script>
        function navigateToStock(ticker) {
            window.location.href = `/stock/${ticker}`;
        }

        function handleSearch(event) {
            event.preventDefault();
            const ticker = document.getElementById('stockSearch').value.trim().toUpperCase();
            if (ticker) {
                window.location.href = `/search?ticker=${encodeURIComponent(ticker)}`;
            }
        }

        // Search suggestions functionality
        const searchInput = document.getElementById('stockSearch');
        const suggestionsContainer = document.getElementById('searchSuggestions');
        const searchMessage = document.getElementById('searchMessage');
        const availableStocks = {{ available_stocks | tojson }};

        searchInput.addEventListener('input', function() {
            const query = this.value.trim().toUpperCase();
            suggestionsContainer.innerHTML = '';
            searchMessage.innerHTML = '';
            
            if (query.length > 0) {
                const matches = availableStocks.filter(stock => 
                    stock.includes(query)
                );
                
                if (matches.length > 0) {
                    // Show top 8 matches
                    matches.slice(0, 8).forEach(stock => {
                        const suggestion = document.createElement('div');
                        suggestion.className = 'search-suggestion';
                        suggestion.innerHTML = `
                            <span>${stock}</span>
                        `;
                        suggestion.onclick = () => {
                            searchInput.value = stock;
                            suggestionsContainer.innerHTML = '';
                            navigateToStock(stock);
                        };
                        suggestionsContainer.appendChild(suggestion);
                    });
                    suggestionsContainer.style.display = 'block';
                    
                    // Show message if there are more matches
                    if (matches.length > 8) {
                        searchMessage.innerHTML = `<div class="search-more">...and ${matches.length - 8} more matches. Press Enter to search.</div>`;
                    }
                } else {
                    suggestionsContainer.style.display = 'none';
                    if (query.length >= 2) {
                        searchMessage.innerHTML = `<div class="search-message-info">Symbol not in suggestions. Press Enter to search Yahoo Finance.</div>`;
                    }
                }
            } else {
                suggestionsContainer.style.display = 'none';
                searchMessage.innerHTML = '';
            }
        });

        // Auto-submit when Enter is pressed
        searchInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const ticker = this.value.trim().toUpperCase();
                if (ticker) {
                    window.location.href = `/search?ticker=${encodeURIComponent(ticker)}`;
                }
                suggestionsContainer.style.display = 'none';
            }
        });

        // Close suggestions when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.search-form')) {
                suggestionsContainer.style.display = 'none';
            }
        });

        // Focus on search input when page loads
        document.addEventListener('DOMContentLoaded', function() {
            searchInput.focus();
        });
    </script>
</body>
</html>